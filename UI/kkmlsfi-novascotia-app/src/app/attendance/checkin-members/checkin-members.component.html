<div class="backdrop"></div>
<dialog class="dialog" open>
    <form (submit)="onFormSubmit()">
        <h3>{{attendance?.attendanceDate | date:'longDate'}}</h3>
        @if (!attendance?.isFinalized) {
            <div class="mt-3">
                @if (members$ | async; as members) {
                    <select class="form-select" (change)="onSelectMember($event)">
                        <option selected [value]="0">--Select a member--</option>
                        @for (member of members; track member.memberId) {
                            <option [value]="member.memberId">{{member.lastName}}, {{member.firstName}}</option>
                        }
                    </select>
                }
            </div>
        }
        
        @if (membersAttendance$ | async; as membersAttendance) {
            <table class="table table-hover mt-3">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Full Name</th>
                        @if (!attendance?.isFinalized) {
                            <th class="text-end"></th>
                        }
                    </tr>
                </thead>
                <tbody>
                    @for (member of membersAttendance; track member.memberId) {
                        <tr>
                            <td>{{$index + 1}}</td>
                            <td>{{member.fullName}}</td>
                            @if (!attendance?.isFinalized) {
                                <td class="text-end">
                                    <a (click)="onDeleteMember(member)" class="btn btn-outline-danger border-0" 
                                        data-toggle="tooltip" title="Delete">
                                        <i class="bi bi-trash-fill"></i>
                                    </a>
                                </td>
                            }
                        </tr>
                    }
                </tbody>
            </table>
        } @else {
            <p>No members.</p>
        }

        
        <div class="mt-3 d-flex justify-content-end gap-1">
            @if (!attendance?.isFinalized) {
                <button type="submit" class="btn btn-primary">Finalize</button>
            }
            <button type="button" class="btn btn-outline-primary" (click)="onCancel()">Close</button>
        </div>
    </form>            
</dialog>